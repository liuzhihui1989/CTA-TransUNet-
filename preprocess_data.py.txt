import os
from PIL import Image
import argparse

def resize_image(image_path, output_path, size):
    """Resize an image and save it to the output path"""
    try:
        image = Image.open(image_path)
        image = image.resize(size, Image.ANTIALIAS)
        image.save(output_path)
    except Exception as e:
        print(f"Error processing {image_path}: {e}")

def resize_dataset(input_dir, output_dir, size=(576, 576)):
    """Resize all images in the input directory and save to the output directory"""
    if not os.path.exists(output_dir):
        os.makedirs(output_dir)

    # Traverse through all files and subdirectories
    for subdir, _, files in os.walk(input_dir):
        for file in files:
            # Only process image files
            if file.lower().endswith(('.png', '.jpg', '.jpeg')):
                input_path = os.path.join(subdir, file)
                relative_path = os.path.relpath(input_path, input_dir)
                output_path = os.path.join(output_dir, relative_path)
                output_subdir = os.path.dirname(output_path)

                if not os.path.exists(output_subdir):
                    os.makedirs(output_subdir)

                resize_image(input_path, output_path, size)
                print(f"Resized {input_path} -> {output_path}")

if __name__ == '__main__':
    parser = argparse.ArgumentParser(description="Resize images in a dataset")
    parser.add_argument('--input_dir', type=str, required=True, help="Path to the input dataset directory")
    parser.add_argument('--output_dir', type=str, required=True, help="Path to save resized images")
    parser.add_argument('--size', type=str, default="576,576", help="Resize dimensions (width,height)")

    args = parser.parse_args()

    # Parse size argument
    size = tuple(map(int, args.size.split(',')))

    # Resize dataset
    resize_dataset(args.input_dir, args.output_dir, size)
